
/*
CODE DESCRIPTION
This works in tandem with revised_ids_session_ids when trying to break out the join_revised_ids_ALL to change the frequency at which User IDs and Session IDs are updated and added to the table. 
This BQ SQL will only update the revised_user_id and revised_user_id_array.
Since the Session ID only needs a 30-minute window, you may choose to update it daily.
While the User ID needs a 30-day look-forward window, so you may update it in larger intervals.

This will query from the revised_ids_ALL table, but only update the Revised User IDs.

Other Required Queries
--revised_ids_ALL
--revised_ids_session_ids

*/

WITH revised_id_table AS (
  SELECT DISTINCT
    session_id,
    date,
    revised_user_id,
    revised_user_id_array
  FROM `bigquery-prod-356116.ga4_3_RevisedIDs.t_ga4_3_RevisedUserIDs`
),

clickstream_table AS (
  SELECT 
    * EXCEPT (revised_user_id, revised_user_id_array)
  FROM
  `bigquery-prod-356116.ga4_3_RevisedIDs.t_ga4_3_ClickstreamRevisedIDs`
)

SELECT
  c.*,
  r.revised_user_id,
  r.revised_user_id_array,
FROM clickstream_table c
LEFT JOIN 
  revised_id_table r ON 
    c.date = r.date AND
    c.session_id = r.session_id
